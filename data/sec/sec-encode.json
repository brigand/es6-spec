{"id":"sec-encode","html":"\n          <h1><span class=\"secnum\" id=\"sec-18.2.6.1.1\"><a href=\"/sec/sec-encode.html\" title=\"link to this section\">18.2.6.1.1</a></span>\n              Runtime Semantics: Encode ( string, unescapedSet )</h1>\n\n          <p class=\"normalbefore\">The encoding and escaping process is described by the abstract operation Encode taking two\n          String arguments <var>string</var> and <var>unescapedSet</var>.</p>\n\n          <ol class=\"proc\">\n            <li>Let <i>strLen</i> be the number of code units in <i>string</i>.</li>\n            <li>Let <i>R</i> be the empty String.</li>\n            <li>Let <i>k</i> be 0.</li>\n            <li>Repeat\n              <ol class=\"block\">\n                <li>If <i>k</i> equals <i>strLen</i>, return <i>R</i>.</li>\n                <li>Let <i>C</i> be the code unit at index <i>k</i> within <i>string</i>.</li>\n                <li>If <i>C</i> is in <i>unescapedSet</i>, then\n                  <ol class=\"block\">\n                    <li>Let <i>S</i> be a String containing only the code unit <i>C</i>.</li>\n                    <li>Let <i>R</i> be a new String value computed by concatenating the previous value of <i>R</i> and\n                        <i>S</i>.</li>\n                  </ol>\n                </li>\n                <li>Else <i>C</i> is not in <i>unescapedSet</i>,\n                  <ol class=\"block\">\n                    <li>If the code unit value of <i>C</i> is not less than 0xDC00 and not greater than 0xDFFF, throw a <b><a href=\"/sec/sec-constructor-properties-of-the-global-object-urierror.html\">URIError</a></b> exception.</li>\n                    <li>If the code unit value of <i>C</i> is less than 0xD800 or greater than 0xDBFF, then\n                      <ol class=\"block\">\n                        <li>Let <i>V</i> be the code unit value of <i>C</i>.</li>\n                      </ol>\n                    </li>\n                    <li>Else,\n                      <ol class=\"block\">\n                        <li>Increase <i>k</i> by 1.</li>\n                        <li>If <i>k</i> equals <i>strLen</i>, throw a <b><a href=\"/sec/sec-constructor-properties-of-the-global-object-urierror.html\">URIError</a></b> exception.</li>\n                        <li>Let <i>kChar</i> be the code unit value of the code unit at index <i>k</i> within <i>string</i>.</li>\n                        <li>If <i>kChar</i> is less than 0xDC00 or greater than 0xDFFF, throw a <b><a href=\"/sec/sec-constructor-properties-of-the-global-object-urierror.html\">URIError</a></b> exception.</li>\n                        <li>Let <i>V</i> be <a href=\"/sec/sec-utf16decode.html\">UTF16Decode</a>(<i>C</i>, <i>kChar</i>).</li>\n                      </ol>\n                    </li>\n                    <li>Let <i>Octets</i> be the array of octets resulting by applying the UTF-8 transformation to <i>V</i>, and\n                        let <i>L</i> be the array size.</li>\n                    <li>Let <i>j</i> be 0.</li>\n                    <li>Repeat, while <i>j</i> &lt; <i>L</i>\n                      <ol class=\"block\">\n                        <li>Let <i>jOctet</i> be the value at index <i>j</i> within <i>Octets</i>.</li>\n                        <li>Let <i>S</i> be a String containing three code units <code>&quot;%</code><i>XY</i><code>&quot;</code> where\n                            <i>XY</i> are two uppercase hexadecimal digits encoding the value of <i>jOctet</i>.</li>\n                        <li>Let <i>R</i> be a new String value computed by concatenating the previous value of <i>R</i> and\n                            <i>S</i>.</li>\n                        <li>Increase <i>j</i> by 1.</li>\n                      </ol>\n                    </li>\n                  </ol>\n                </li>\n                <li>Increase <i>k</i> by 1.</li>\n              </ol>\n            </li>\n          </ol>\n        "}