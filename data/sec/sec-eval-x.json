{"id":"sec-eval-x","html":"\n      <div class=\"front\">\n        <h1><span class=\"secnum\" id=\"sec-18.2.1\"><a href=\"/sec/sec-eval-x.html\" title=\"link to this section\">18.2.1</a></span> eval\n            (x)</h1>\n\n        <p class=\"normalbefore\">The <code>eval</code> function is the %eval% intrinsic object. When the <code>eval</code> function\n        is called with one argument <var>x</var>, the following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>evalRealm</i> be the value of the active function object&#x2019;s [[Realm]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</li>\n          <li>Let <i>strictCaller</i> be <b>false</b>.</li>\n          <li>Let <i>directEval</i> be <b>false</b>.</li>\n          <li>Return <a href=\"/sec/sec-performeval.html\">PerformEval</a>(<i>x</i>, <i>evalRealm</i>, <i>strictCaller</i>,\n              <i>directEval</i>).</li>\n        </ol>\n      </div>\n\n      <section id=\"sec-performeval\">\n        <h1><span class=\"secnum\" id=\"sec-18.2.1.1\"><a href=\"/sec/sec-performeval.html\" title=\"link to this section\">18.2.1.1</a></span>\n            Runtime Semantics: PerformEval( x, evalRealm, strictCaller, direct)</h1>\n\n        <p class=\"normalbefore\">The abstract operation PerformEval with arguments <var>x</var>, <var>evalRealm</var>,\n        <var>strictCaller</var>, and <var>direct</var> performs the following steps:</p>\n\n        <ol class=\"proc\">\n          <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: If <i>direct</i> is <b>false</b> then  <i>strictCaller</i> is also\n              <b>false</b>.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>x</i>) is not String, return <i>x</i>.</li>\n          <li>Let <i>script</i> be the ECMAScript code that is the result of parsing <i>x</i>, interpreted as UTF-16 encoded\n              Unicode text as described in <a href=\"/sec/sec-ecmascript-language-types-string-type.html\">6.1.4</a><i>,</i> for the goal\n              symbol <i>Script</i>. If the parse fails or any early errors are detected, throw a <b>SyntaxError</b> exception (but\n              <a href=\"/sec/sec-error-handling-and-language-extensions.html\">see also clause 16</a>).</li>\n          <li>If <i>script</i> Contains <i>ScriptBody</i> is <b>false</b>, return <b>undefined</b>.</li>\n          <li>Let <i>body</i> be the <i>ScriptBody</i> of <i>script.</i></li>\n          <li>If <i>strictCaller</i> is <b>true</b>, let <i>strictEval</i> be <b>true.</b></li>\n          <li>Else, let <i>strictEval</i> be IsStrict of <i>script</i>.</li>\n          <li>Let <i>ctx</i> be <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a>. If <i>direct</i> is\n              <b>true</b> <i>ctx</i> will be the <a href=\"/sec/sec-execution-contexts.html\">execution context</a> that performed the direct\n              <code>eval</code>. If <i>direct</i> is <b>false</b> <i>ctx</i> will be the <a href=\"/sec/sec-execution-contexts.html\">execution context</a> for the invocation of the eval function.</li>\n          <li>If <i>direct</i> is <b>true</b>, then\n            <ol class=\"block\">\n              <li>Let <i>lexEnv</i> be <a href=\"/sec/sec-newdeclarativeenvironment.html\">NewDeclarativeEnvironment</a>(<i>ctx&#x2019;s</i>\n                  <a href=\"/sec/sec-execution-contexts.html\">LexicalEnvironment</a>).</li>\n              <li>Let <i>varEnv</i> be <i>ctx&#x2019;s</i> <a href=\"/sec/sec-execution-contexts.html\">VariableEnvironment</a>.</li>\n            </ol>\n          </li>\n          <li>Else,\n            <ol class=\"block\">\n              <li>Let <i>lexEnv</i> be <a href=\"/sec/sec-newdeclarativeenvironment.html\">NewDeclarativeEnvironment</a>(<i>evalRealm</i>.[[globalEnv]]).</li>\n              <li>Let <i>varEnv</i> be <i>evalRealm</i>.[[globalEnv]].</li>\n            </ol>\n          </li>\n          <li>If <i>strictEval</i> is <b>true</b>, let <i>varEnv</i> be <i>lexEnv</i>.</li>\n          <li>If <i>ctx</i> is not already <a href=\"/sec/sec-execution-contexts.html\">suspended</a>, <a href=\"/sec/sec-execution-contexts.html\">Suspend</a> <i>ctx</i>.</li>\n          <li>Let <i>evalCxt</i> be a new <a href=\"/sec/sec-execution-contexts.html\">ECMAScript code execution context</a>.</li>\n          <li>Set the <i>evalCxt&#x2019;s</i> <a href=\"/sec/sec-code-realms.html\">Realm</a>  to <i>evalRealm</i>.</li>\n          <li>Set the <i>evalCxt&#x2019;s</i> <a href=\"/sec/sec-execution-contexts.html\">VariableEnvironment</a> to <i>varEnv</i>.</li>\n          <li>Set the <i>evalCxt&#x2019;s</i> <a href=\"/sec/sec-execution-contexts.html\">LexicalEnvironment</a> to <i>lexEnv</i>.</li>\n          <li>Push <i>evalCxt</i> on to <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a>; <i>evalCxt</i> is now\n              <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a>.</li>\n          <li>Let <i>result</i> be <a href=\"/sec/sec-evaldeclarationinstantiation.html\">EvalDeclarationInstantiation</a>(<i>body</i>,\n              <i>varEnv</i>, <i>lexEnv</i>, <i>strictEval</i>).</li>\n          <li>If <i>result</i>.[[type]] is <span style=\"font-family: sans-serif\">normal</span>, then\n            <ol class=\"block\">\n              <li>Let <i>result</i> be the result of evaluating <i>body</i>.</li>\n            </ol>\n          </li>\n          <li>If <i>result</i>.[[type]] is <span style=\"font-family: sans-serif\">normal</span> and <i>result</i>.[[value]] is\n              <span style=\"font-family: sans-serif\">empty</span>,  then\n            <ol class=\"block\">\n              <li>Let <i>result</i> be <a href=\"/sec/sec-normalcompletion.html\">NormalCompletion</a>(<b>undefined</b>).</li>\n            </ol>\n          </li>\n          <li><a href=\"/sec/sec-execution-contexts.html\">Suspend</a> <i>evalCxt</i> and remove it from <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a>.</li>\n          <li>Resume the context that is now on the top of <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a> as <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a>.</li>\n          <li>Return <a href=\"/sec/sec-completion-record-specification-type.html\">Completion</a>(<i>result</i>).</li>\n        </ol>\n\n        <div class=\"note\">\n          <p><span class=\"nh\">NOTE</span> The eval code cannot instantiate variable or function bindings in the variable\n          environment of the calling context that invoked the eval if the calling context is evaluating formal parameter\n          initializers or if either the code of the calling context or the eval code is <a href=\"/sec/sec-strict-mode-code.html\">strict\n          code</a>. Instead such bindings are instantiated in a new <a href=\"/sec/sec-execution-contexts.html\">VariableEnvironment</a> that\n          is only accessible to the eval code. Bindings introduced by <code>let</code>, <code>const</code>, or <code>class</code>\n          declarations are always instantiated in a new <a href=\"/sec/sec-execution-contexts.html\">LexicalEnvironment</a>.</p>\n        </div>\n      </section>\n\n      <section id=\"sec-evaldeclarationinstantiation\">\n        <h1><span class=\"secnum\" id=\"sec-18.2.1.2\"><a href=\"/sec/sec-evaldeclarationinstantiation.html\" title=\"link to this section\">18.2.1.2</a></span> Runtime Semantics: EvalDeclarationInstantiation( body, varEnv,\n            lexEnv, strict)</h1>\n\n        <p>When the abstract operation EvalDeclarationInstantiation is called with arguments <var>body</var>, <var>varEnv</var>,\n        <var>lexEnv</var>, and <var>strict</var> the following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>varNames</i> be the VarDeclaredNames of <i>body</i>.</li>\n          <li>Let <i>varDeclarations</i> be the VarScopedDeclarations of <i>body</i>.</li>\n          <li>Let <i>lexEnvRec</i> be <i>lexEnv</i>&#x2019;s <a href=\"/sec/sec-lexical-environments.html\">EnvironmentRecord</a>.</li>\n          <li>Let <i>varEnvRec</i> be <i>varEnv</i>&#x2019;s <a href=\"/sec/sec-lexical-environments.html\">EnvironmentRecord</a>.</li>\n          <li>If <i>strict</i> is <b>false</b>, then\n            <ol class=\"block\">\n              <li>If <i>varEnvRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                <ol class=\"block\">\n                  <li>For each <i>name</i> in <i>varNames</i>, do\n                    <ol class=\"block\">\n                      <li>If <i>varEnvRec.</i><a href=\"/sec/sec-haslexicaldeclaration.html\">HasLexicalDeclaration</a>(<i>name</i>) is\n                          <b>true</b>, throw a <b>SyntaxError</b> exception.</li>\n                      <li>NOTE:  <code>eval</code> will not create a global var declaration that would be shadowed by a global\n                          lexical declaration.</li>\n                    </ol>\n                  </li>\n                </ol>\n              </li>\n              <li>Let <i>thisLex</i> be <i>lexEnv</i>.</li>\n              <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: the following loop will terminate.</li>\n              <li>Repeat while <i>thisLex</i> is not the same as <i>varEnv,</i>\n                <ol class=\"block\">\n                  <li>Let <i>thisEnvRec</i> be <i>thisLex</i>&#x2019;s <a href=\"/sec/sec-lexical-environments.html\">EnvironmentRecord</a>.</li>\n                  <li>If <i>thisEnvRec</i> is not an object <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                    <ol class=\"block\">\n                      <li>NOTE:  The environment of with statements cannot contain any lexical declaration so it doesn&#x2019;t\n                          need to be checked for var/let hoisting conflicts.</li>\n                      <li>For each <i>name</i> in <i>varNames</i>, do\n                        <ol class=\"block\">\n                          <li>If <i>thisEnvRec.</i>HasBinding(<i>name</i>) is <b>true</b>, then\n                            <ol class=\"block\">\n                              <li>Throw a <b>SyntaxError</b> exception.</li>\n                            </ol>\n                          </li>\n                          <li>NOTE:  A direct <code>eval</code> will not hoist var declaration over a like-named lexical\n                              declaration.</li>\n                        </ol>\n                      </li>\n                    </ol>\n                  </li>\n                  <li>Let <i>thisLex</i> be <i>thisLex</i>&#x2019;s <a href=\"/sec/sec-lexical-environments.html\">outer environment\n                      reference</a>.</li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>Let <i>functionsToInitialize</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n          <li>Let <i>declaredFunctionNames</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n          <li>For each <i>d</i> in <i>varDeclarations</i>, in reverse list order do\n            <ol class=\"block\">\n              <li>If <i>d</i> is neither a <i>VariableDeclaration</i> or a <i>ForBinding</i>, then\n                <ol class=\"block\">\n                  <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>d</i> is either a <i>FunctionDeclaration</i> or a\n                      <i>GeneratorDeclaration</i>.</li>\n                  <li>NOTE\tIf there are multiple <span style=\"font-family: Times New Roman\"><i>FunctionDeclarations</i></span>\n                      for the same name, the last declaration is used.</li>\n                  <li>Let <i>fn</i> be the sole element of the BoundNames of <i>d.</i></li>\n                  <li>If <i>fn</i> is not an element of <i>declaredFunctionNames</i>, then\n                    <ol class=\"block\">\n                      <li>If <i>varEnvRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                        <ol class=\"block\">\n                          <li>Let <i>fnDefinable</i> be <i>varEnvRec</i>.<a href=\"/sec/sec-candeclareglobalfunction.html\">CanDeclareGlobalFunction</a>(<i>fn</i>).</li>\n                          <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>fnDefinable</i>).</li>\n                          <li>If <i>fnDefinable</i> is <b>false</b>, throw <b>SyntaxError</b> exception.</li>\n                        </ol>\n                      </li>\n                      <li>Append <i>fn</i> to <i>declaredFunctionNames</i>.</li>\n                      <li>Insert <i>d</i> as the first element of <i>functionsToInitialize</i>.</li>\n                    </ol>\n                  </li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>Let <i>declaredVarNames</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n          <li>For each <i>d</i> in <i>varDeclarations</i>, do\n            <ol class=\"block\">\n              <li>If <i>d</i> is a <i>VariableDeclaration</i> or a <i>ForBinding</i>, then\n                <ol class=\"block\">\n                  <li>For each String <i>vn</i> in the BoundNames of <i>d</i>, do\n                    <ol class=\"block\">\n                      <li>If <i>vn</i> is not an element of <i>declaredFunctionNames</i>, then\n                        <ol class=\"block\">\n                          <li>If <i>varEnvRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                            <ol class=\"block\">\n                              <li>Let <i>vnDefinable</i> be <i>varEnvRec.</i><a href=\"/sec/sec-candeclareglobalvar.html\">CanDeclareGlobalVar</a>(<i>vn</i>).</li>\n                              <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>vnDefinable</i>).</li>\n                              <li>If <i>vnDefinable</i> is <b>false</b>, throw <b>SyntaxError</b> exception.</li>\n                            </ol>\n                          </li>\n                          <li>If <i>vn</i> is not an element of <i>declaredVarNames</i>, then\n                            <ol class=\"block\">\n                              <li>Append <i>vn</i> to <i>declaredVarNames</i>.</li>\n                            </ol>\n                          </li>\n                        </ol>\n                      </li>\n                    </ol>\n                  </li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>NOTE: No abnormal terminations occur after this algorithm step unless <span style=\"font-family: Times New\n              Roman\"><i>varEnvRec</i></span> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a> and the global\n              object is a Proxy exotic object.</li>\n          <li>Let <i>lexDeclarations</i> be the LexicallyScopedDeclarations of <i>body</i>.</li>\n          <li>For each element <i>d</i> in <i>lexDeclarations</i> do\n            <ol class=\"block\">\n              <li>NOTE  Lexically declared names are only instantiated here but not initialized.</li>\n              <li>For each element <i>dn</i> of the BoundNames of <i>d</i> do\n                <ol class=\"block\">\n                  <li>If  IsConstantDeclaration of <i>d</i> is <b>true</b>, then\n                    <ol class=\"block\">\n                      <li>Let <i>status</i> be <i>lexEnvRec</i>.CreateImmutableBinding(<i>dn</i>, <b>true</b>).</li>\n                    </ol>\n                  </li>\n                  <li>Else,\n                    <ol class=\"block\">\n                      <li>Let <i>status</i> be <i>lexEnvRec</i>.CreateMutableBinding(<i>dn</i>, <b>false</b>).</li>\n                    </ol>\n                  </li>\n                  <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>For each production <i>f</i> in <i>functionsToInitialize</i>, do\n            <ol class=\"block\">\n              <li>Let <i>fn</i> be the sole element of the BoundNames of <i>f.</i></li>\n              <li>Let <i>fo</i> be the result of performing InstantiateFunctionObject  for <i>f</i> with argument\n                  <i>lexEnv</i>.</li>\n              <li>If <i>varEnvRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                <ol class=\"block\">\n                  <li>Let <i>status</i> be <i>varEnvRec</i>.<a href=\"/sec/sec-createglobalfunctionbinding.html\">CreateGlobalFunctionBinding</a>(<i>fn</i>, <i>fo</i>,\n                      <b>true</b>).</li>\n                  <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n                </ol>\n              </li>\n              <li>Else,\n                <ol class=\"block\">\n                  <li>Let <i>bindingExists</i> be <i>varEnvRec</i>.HasBinding(<i>fn</i>).</li>\n                  <li>If <i>bindingExists</i> is <b>false</b>, then\n                    <ol class=\"block\">\n                      <li>Let <i>status</i> be <i>varEnvRec</i>.CreateMutableBinding(<i>fn</i>, <b>true</b>).</li>\n                      <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>status</i> is not an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a> because of validation preceding\n                          step 12.</li>\n                      <li>Let <i>status</i> be <i>varEnvRec</i>.InitializeBinding(<i>fn</i>, <i>fo</i>).</li>\n                    </ol>\n                  </li>\n                  <li>Else,\n                    <ol class=\"block\">\n                      <li>Let <i>status</i> be <i>varEnvRec</i>.SetMutableBinding(<i>fn</i>, <i>fo</i>, <b>false</b>).</li>\n                    </ol>\n                  </li>\n                  <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>status</i> is not an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>.</li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>For each String <i>vn</i> in <i>declaredVarNames</i>, in list order do\n            <ol class=\"block\">\n              <li>If <i>varEnvRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>, then\n                <ol class=\"block\">\n                  <li>Let <i>status</i> be <i>varEnvRec.</i><a href=\"/sec/sec-createglobalvarbinding.html\">CreateGlobalVarBinding</a>(<i>vn</i>, <b>true</b>).</li>\n                  <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n                </ol>\n              </li>\n              <li>Else,\n                <ol class=\"block\">\n                  <li>Let <i>bindingExists</i> be <i>varEnvRec</i>.HasBinding(<i>vn</i>).</li>\n                  <li>If <i>bindingExists</i> is <b>false</b>, then\n                    <ol class=\"block\">\n                      <li>Let <i>status</i> be <i>varEnvRec</i>.CreateMutableBinding(<i>vn</i>, <b>true</b>).</li>\n                      <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>status</i> is not an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a> because of validation preceding\n                          step 12.</li>\n                      <li>Let <i>status</i> be <i>varEnvRec</i>.InitializeBinding(<i>vn</i>, <b>undefined</b>).</li>\n                      <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>status</i> is not an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>.</li>\n                    </ol>\n                  </li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>Return <a href=\"/sec/sec-normalcompletion.html\">NormalCompletion</a>(<span style=\"font-family: sans-serif\">empty</span>)</li>\n        </ol>\n\n        <div class=\"note\">\n          <p><span class=\"nh\">NOTE</span> An alternative version of this algorithm is described in <a href=\"/sec/sec-variablestatements-in-catch-blocks.html\">B.3.5</a>.</p>\n        </div>\n      </section>\n    "}