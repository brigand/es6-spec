{"id":"sec-globaldeclarationinstantiation","html":"\n      <h1><span class=\"secnum\" id=\"sec-15.1.8\"><a href=\"/sec/sec-globaldeclarationinstantiation.html\" title=\"link to this section\">15.1.8</a></span> Runtime Semantics: GlobalDeclarationInstantiation (script, env)</h1>\n\n      <div class=\"note\">\n        <p><span class=\"nh\">NOTE 1</span> When an <a href=\"/sec/sec-execution-contexts.html\">execution context</a> is established for\n        evaluating scripts, declarations are instantiated in the current global environment. Each global binding declared in the\n        code is instantiated.</p>\n      </div>\n\n      <p class=\"normalbefore\">GlobalDeclarationInstantiation is performed as follows using arguments <var>script</var> and\n      <var>env</var>. <var>script</var> is the <span class=\"nt\">ScriptBody</span> for which the <a href=\"/sec/sec-execution-contexts.html\">execution context</a> is being established. <var>env</var> is the global <a href=\"/sec/sec-lexical-environments.html\">lexical environment</a> in which bindings are to be created.</p>\n\n      <ol class=\"proc\">\n        <li>Let <i>envRec</i> be <i>env</i>&#x2019;s <a href=\"/sec/sec-lexical-environments.html\">EnvironmentRecord</a>.</li>\n        <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>envRec</i> is a global <a href=\"/sec/sec-environment-records.html\">Environment Record</a>.</li>\n        <li>Let <i>lexNames</i> be the LexicallyDeclaredNames of <i>script</i>.</li>\n        <li>Let <i>varNames</i> be the VarDeclaredNames of <i>script</i>.</li>\n        <li>For each <i>name</i> in <i>lexNames</i>, do\n          <ol class=\"block\">\n            <li>If <i>envRec.</i><a href=\"/sec/sec-hasvardeclaration.html\">HasVarDeclaration</a>(<i>name</i>) is <b>true</b>, throw a\n                <b>SyntaxError</b> exception.</li>\n            <li>If <i>envRec.</i><a href=\"/sec/sec-haslexicaldeclaration.html\">HasLexicalDeclaration</a>(<i>name</i>) is <b>true</b>, throw\n                a <b>SyntaxError</b> exception.</li>\n            <li>Let <i>hasRestrictedGlobal</i> be <i>envRec.</i><a href=\"/sec/sec-hasrestrictedglobalproperty.html\">HasRestrictedGlobalProperty</a>(<i>name</i>).</li>\n            <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>hasRestrictedGlobal</i>).</li>\n            <li>If <i>hasRestrictedGlobal</i> is <b>true</b>, throw a <b>SyntaxError</b> exception.</li>\n          </ol>\n        </li>\n        <li>For each <i>name</i> in <i>varNames</i>, do\n          <ol class=\"block\">\n            <li>If <i>envRec.</i><a href=\"/sec/sec-haslexicaldeclaration.html\">HasLexicalDeclaration</a>(<i>name</i>) is <b>true</b>, throw\n                a <b>SyntaxError</b> exception.</li>\n          </ol>\n        </li>\n        <li>Let <i>varDeclarations</i> be the VarScopedDeclarations of <i>script</i>.</li>\n        <li>Let <i>functionsToInitialize</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n        <li>Let <i>declaredFunctionNames</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n        <li>For each <i>d</i> in <i>varDeclarations</i>, in reverse list order do\n          <ol class=\"block\">\n            <li>If <i>d</i> is neither a <i>VariableDeclaration</i> or a <i>ForBinding</i>, then\n              <ol class=\"block\">\n                <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>d</i> is either a <i>FunctionDeclaration</i> or a\n                    <i>GeneratorDeclaration</i>.</li>\n                <li>NOTE\tIf there are multiple <span style=\"font-family: Times New Roman\"><i>FunctionDeclarations</i></span>\n                    for the same name, the last declaration is used.</li>\n                <li>Let <i>fn</i> be the sole element of the BoundNames of <i>d.</i></li>\n                <li>If <i>fn</i> is not an element of <i>declaredFunctionNames</i>, then\n                  <ol class=\"block\">\n                    <li>Let <i>fnDefinable</i> be <i>envRec.</i><a href=\"/sec/sec-candeclareglobalfunction.html\">CanDeclareGlobalFunction</a>(<i>fn</i>).</li>\n                    <li>If <i>fnDefinable</i> is <b>false</b>, throw <b>TypeError</b> exception.</li>\n                    <li>Append <i>fn</i> to <i>declaredFunctionNames</i>.</li>\n                    <li>Insert <i>d</i> as the first element of <i>functionsToInitialize</i>.</li>\n                  </ol>\n                </li>\n              </ol>\n            </li>\n          </ol>\n        </li>\n        <li>Let <i>declaredVarNames</i> be an empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n        <li>For each <i>d</i> in <i>varDeclarations</i>, do\n          <ol class=\"block\">\n            <li>If <i>d</i> is a <i>VariableDeclaration</i> or a <i>ForBinding</i>, then\n              <ol class=\"block\">\n                <li>For each String <i>vn</i> in the BoundNames of <i>d</i>, do\n                  <ol class=\"block\">\n                    <li>If <i>vn</i> is not an element of <i>declaredFunctionNames</i>, then\n                      <ol class=\"block\">\n                        <li>Let <i>vnDefinable</i> be <i>envRec.</i><a href=\"/sec/sec-candeclareglobalvar.html\">CanDeclareGlobalVar</a>(<i>vn</i>).</li>\n                        <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>vnDefinable</i>).</li>\n                        <li>If <i>vnDefinable</i> is <b>false</b>, throw <b>TypeError</b> exception.</li>\n                        <li>If <i>vn</i> is not an element of <i>declaredVarNames</i>, then\n                          <ol class=\"block\">\n                            <li>Append <i>vn</i> to <i>declaredVarNames</i>.</li>\n                          </ol>\n                        </li>\n                      </ol>\n                    </li>\n                  </ol>\n                </li>\n              </ol>\n            </li>\n          </ol>\n        </li>\n        <li>NOTE: No abnormal terminations occur after this algorithm step if the global object is an ordinary object. However, if\n            the global object is a Proxy exotic object it may exhibit behaviours that cause abnormal terminations in some of the\n            following steps.</li>\n        <li>Let <i>lexDeclarations</i> be the LexicallyScopedDeclarations of <i>script</i>.</li>\n        <li>For each element <i>d</i> in <i>lexDeclarations</i> do\n          <ol class=\"block\">\n            <li>NOTE  Lexically declared names are only instantiated here but not initialized.</li>\n            <li>For each element <i>dn</i> of the BoundNames of <i>d</i> do\n              <ol class=\"block\">\n                <li>If  IsConstantDeclaration of <i>d</i> is <b>true</b>, then\n                  <ol class=\"block\">\n                    <li>Let <i>status</i> be <i>envRec</i>.CreateImmutableBinding(<i>dn</i>, <b>true</b>).</li>\n                  </ol>\n                </li>\n                <li>Else,\n                  <ol class=\"block\">\n                    <li>Let <i>status</i> be <i>envRec</i>.CreateMutableBinding(<i>dn</i>, <b>false</b>).</li>\n                  </ol>\n                </li>\n                <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n              </ol>\n            </li>\n          </ol>\n        </li>\n        <li>For each production <i>f</i> in <i>functionsToInitialize</i>, do\n          <ol class=\"block\">\n            <li>Let <i>fn</i> be the sole element of the BoundNames of <i>f.</i></li>\n            <li>Let <i>fo</i> be the result of performing InstantiateFunctionObject  for <i>f</i> with argument <i>env</i>.</li>\n            <li>Let <i>status</i> be <i>envRec</i>.<a href=\"/sec/sec-createglobalfunctionbinding.html\">CreateGlobalFunctionBinding</a>(<i>fn</i>, <i>fo</i>, <b>false</b>).</li>\n            <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n          </ol>\n        </li>\n        <li>For each String <i>vn</i> in <i>declaredVarNames</i>, in list order do\n          <ol class=\"block\">\n            <li>Let <i>status</i> be <i>envRec.</i><a href=\"/sec/sec-createglobalvarbinding.html\">CreateGlobalVarBinding</a>(<i>vn</i>,\n                <b>false</b>).</li>\n            <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>status</i>).</li>\n          </ol>\n        </li>\n        <li>Return <a href=\"/sec/sec-normalcompletion.html\">NormalCompletion</a>(<span style=\"font-family: sans-serif\">empty</span>)</li>\n      </ol>\n\n      <div class=\"note\">\n        <p><span class=\"nh\">NOTE 2</span> Early errors specified in <a href=\"/sec/sec-scripts-static-semantics-early-errors.html\">15.1.1</a>\n        prevent name conflicts between function/var declarations and let/const/class declarations as well as redeclaration of\n        let/const/class bindings for declaration contained within a single <span class=\"nt\">Script</span>. However, such conflicts\n        and redeclarations that span more than one <span class=\"nt\">Script</span> are detected as runtime errors during\n        GlobalDeclarationInstantiation. If any such errors are detected, no bindings are instantiated for the script. However, if\n        the global object is defined using Proxy exotic objects then the runtime tests for conflicting declarations may be\n        unreliable resulting in an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a> and some global\n        declarations not being instantiated. If this occurs, the code for the <span class=\"nt\">Script</span> is not evaluated.</p>\n\n        <p>Unlike explicit var or function declarations, properties that are directly created on the global object result in\n        global bindings that may be shadowed by let/const/class declarations.</p>\n      </div>\n    "}