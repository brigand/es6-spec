{"id":"sec-jobs-and-job-queues","html":"\n    <div class=\"front\">\n      <h1><span class=\"secnum\" id=\"sec-8.4\"><a href=\"/sec/sec-jobs-and-job-queues.html\" title=\"link to this section\">8.4</a></span> Jobs\n          and Job Queues</h1>\n\n      <p>A Job is an abstract operation that initiates an ECMAScript computation when no other ECMAScript computation is currently\n      in progress. A Job abstract operation may be defined to accept an arbitrary set of job parameters.</p>\n\n      <p>Execution of a Job can be initiated only when there is no running <a href=\"/sec/sec-execution-contexts.html\">execution context</a>\n      and <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a> is empty. A PendingJob is a request for the future\n      execution of a Job. A PendingJob is an internal Record whose fields are specified in <a href=\"/sec/table-25.html\">Table 25</a>. Once\n      execution of a Job is initiated, the Job always executes to completion. No other Job may be initiated until the currently\n      running Job completes. However, the currently running Job or external events may cause the enqueuing of additional\n      PendingJobs that may be initiated sometime after completion of the currently running Job.</p>\n\n      <figure>\n        <figcaption><span id=\"table-25\">Table 25</span> &#x2014; PendingJob Record Fields</figcaption>\n        <table class=\"real-table\">\n          <tr>\n            <th>Field Name</th>\n            <th>Value</th>\n            <th>Meaning</th>\n          </tr>\n          <tr>\n            <td>[[Job]]</td>\n            <td>The name of a Job abstract operation</td>\n            <td>This is the abstract operation that is performed when execution of this PendingJob is initiated. Jobs are abstract operations that use NextJob rather than Return to indicate that they have completed.</td>\n          </tr>\n          <tr>\n            <td>[[Arguments]]</td>\n            <td>A <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a></td>\n            <td>The <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> of argument values that are to be passed to [[Job]] when it is activated.</td>\n          </tr>\n          <tr>\n            <td>[[Realm]]</td>\n            <td>A <a href=\"/sec/sec-code-realms.html\">Realm</a> Record</td>\n            <td>The <a href=\"/sec/sec-code-realms.html\">Realm</a> for the initial <a href=\"/sec/sec-execution-contexts.html\">execution context</a> when this Pending Job is initiated.</td>\n          </tr>\n          <tr>\n            <td>[[HostDefined]]</td>\n            <td>Any, default value is <span class=\"value\">undefined</span>.</td>\n            <td>Field reserved for use by host environments that need to associate additional information with a pending Job.</td>\n          </tr>\n        </table>\n      </figure>\n\n      <p>A Job Queue is a FIFO queue of PendingJob records. Each Job Queue has a name and the full set of available Job Queues are\n      defined by an ECMAScript implementation. Every ECMAScript implementation has at least the Job Queues defined in <a href=\"/sec/table-26.html\">Table 26</a>.</p>\n\n      <figure>\n        <figcaption><span id=\"table-26\">Table 26</span> &#x2014; Required Job Queues</figcaption>\n        <table class=\"real-table\">\n          <tr>\n            <th>Name</th>\n            <th>Purpose</th>\n          </tr>\n          <tr>\n            <td>ScriptJobs</td>\n            <td>Jobs that validate and evaluate ECMAScript <span class=\"nt\">Script</span> and <span class=\"nt\">Module</span> source text. See clauses 10 and 15.</td>\n          </tr>\n          <tr>\n            <td>PromiseJobs</td>\n            <td>Jobs that are responses to the settlement of a Promise (<a href=\"/sec/sec-promise-objects.html\">see 25.4</a>).</td>\n          </tr>\n        </table>\n      </figure>\n\n      <p>A request for the future execution of a Job is made by enqueueing, on a Job Queue, a PendingJob record that includes a\n      Job abstract operation name and any necessary argument values. When there is no running <a href=\"/sec/sec-execution-contexts.html\">execution context</a> and <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a>\n      is empty, the ECMAScript implementation removes the first PendingJob from a Job Queue and uses the information contained in\n      it to create an <a href=\"/sec/sec-execution-contexts.html\">execution context</a> and starts execution of the associated Job abstract\n      operation.</p>\n\n      <p>The PendingJob records from a single Job Queue are always initiated in FIFO order. This specification does not define the\n      order in which multiple Job Queues are serviced. An ECMAScript implementation may interweave the FIFO evaluation of the\n      PendingJob records of a Job Queue with the evaluation of the PendingJob records of one or more other Job Queues. An\n      implementation must define what occurs when there are no running <a href=\"/sec/sec-execution-contexts.html\">execution context</a> and\n      all Job Queues are empty.</p>\n\n      <div class=\"note\">\n        <p><span class=\"nh\">NOTE</span> Typically an ECMAScript implementation will have its Job Queues pre-initialized with at\n        least one PendingJob and one of those Jobs will be the first to be executed. An implementation might choose to free all\n        resources and terminate if the current Job completes and all Job Queues are empty. Alternatively, it might choose to wait\n        for a some implementation specific agent or mechanism to enqueue new PendingJob requests.</p>\n      </div>\n\n      <p>The following abstract operations are used to create and manage Jobs and Job Queues:</p>\n    </div>\n\n    <section id=\"sec-enqueuejob\">\n      <h1><span class=\"secnum\" id=\"sec-8.4.1\"><a href=\"/sec/sec-enqueuejob.html\" title=\"link to this section\">8.4.1</a></span> EnqueueJob\n          (queueName, job, arguments)</h1>\n\n      <p class=\"normalbefore\">The EnqueueJob abstract operation requires three arguments: <var>queueName</var>, <var>job</var>,\n      and <var>arguments</var>. It performs the following steps:</p>\n\n      <ol class=\"proc\">\n        <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>queueName</i>) is String and its value is the name of a Job\n            Queue recognized by this implementation.</li>\n        <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>job</i> is the name of a Job.</li>\n        <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: <i>arguments</i> is a <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> that has the same number of elements as the number of\n            parameters required by <i>job</i>.</li>\n        <li>Let <i>callerContext</i> be <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a>.</li>\n        <li>Let <i>callerRealm</i> be <i>callerContext&#x2019;s</i> <a href=\"/sec/sec-code-realms.html\">Realm</a>.</li>\n        <li>Let <i>pending</i> be PendingJob{ [[Job]]: <i>job</i>, [[Arguments]]: <i>arguments</i>, [[Realm]]: <i>callerRealm</i>,\n            [[HostDefined]]: <b>undefined</b> }.</li>\n        <li>Perform any implementation or host environment defined processing of <i>pending</i>. This may include modifying the\n            [[HostDefined]] field or any other field of <i>pending</i>.</li>\n        <li>Add <i>pending</i> at the back of the Job Queue named by <i>queueName</i>.</li>\n        <li>Return <a href=\"/sec/sec-normalcompletion.html\">NormalCompletion</a>(<span style=\"font-family: sans-serif\">empty</span>).</li>\n      </ol>\n    </section>\n\n    <section id=\"sec-nextjob-result\">\n      <h1><span class=\"secnum\" id=\"sec-8.4.2\"><a href=\"/sec/sec-nextjob-result.html\" title=\"link to this section\">8.4.2</a></span> NextJob\n          result</h1>\n\n      <p class=\"normalbefore\">An algorithm step such as:</p>\n\n      <ol class=\"proc\">\n        <li>NextJob <i>result</i>.</li>\n      </ol>\n\n      <p>is used in Job abstract operations in place of:</p>\n\n      <ol class=\"proc\">\n        <li>Return <i>result</i>.</li>\n      </ol>\n\n      <p>Job abstract operations must not contain a Return step or a <a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a> step. The\n      NextJob <var>result</var> operation is equivalent to the following steps:</p>\n\n      <ol class=\"proc\">\n        <li>If <i>result</i> is an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>, perform\n            implementation defined unhandled exception processing.</li>\n        <li><a href=\"/sec/sec-execution-contexts.html\">Suspend</a> <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a> and\n            remove it from <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a>.</li>\n        <li><a href=\"/sec/sec-algorithm-conventions.html\">Assert</a>: The <a href=\"/sec/sec-execution-contexts.html\">execution context stack</a> is\n            now empty.</li>\n        <li>Let <i>nextQueue</i> be a non-empty Job Queue chosen in an implementation defined manner. If all Job Queues are empty,\n            the result is implementation defined.</li>\n        <li>Let <i>nextPending</i> be the PendingJob record at the front of <i>nextQueue</i>. Remove that record from\n            <i>nextQueue</i>.</li>\n        <li>Let <i>newContext</i> be a new <a href=\"/sec/sec-execution-contexts.html\">execution context</a>.</li>\n        <li>Set <i>newContext</i>&#x2019;s <a href=\"/sec/sec-code-realms.html\">Realm</a> to <i>nextPending</i>.[[Realm]].</li>\n        <li>Push <i>newContext</i> onto <a href=\"/sec/sec-execution-contexts.html\">the execution context stack</a>; <i>newContext</i> is\n            now <a href=\"/sec/sec-execution-contexts.html\">the running execution context</a>.</li>\n        <li>Perform any implementation or host environment defined job initialization using <i>nextPending</i>.</li>\n        <li>Perform the abstract operation named by <i>nextPending</i>.[[Job]] using the elements of\n            <i>nextPending</i>.[[Arguments]] as its arguments.</li>\n      </ol>\n    </section>\n  "}