{"id":"sec-weakmap-objects","html":"\n    <div class=\"front\">\n      <h1><span class=\"secnum\" id=\"sec-23.3\"><a href=\"/sec/sec-weakmap-objects.html\" title=\"link to this section\">23.3</a></span> WeakMap\n          Objects</h1>\n\n      <p>WeakMap objects are collections of key/value pairs where the keys are objects and values may be arbitrary <a href=\"/sec/sec-ecmascript-language-types.html\">ECMAScript language values</a>. A WeakMap may be queried to see if it contains a\n      key/value pair with a specific key, but no mechanism is provided for enumerating the objects it holds as keys. If an object\n      that is being used as the key of a WeakMap key/value pair is only reachable by following a chain of references that start\n      within that WeakMap, then that key/value pair is inaccessible and is automatically removed from the WeakMap. WeakMap\n      implementations must detect and remove such key/value pairs and any associated resources.</p>\n\n      <p>An implementation may impose an arbitrarily determined latency between the time a key/value pair of a WeakMap becomes\n      inaccessible and the time when the key/value pair is removed from the WeakMap. If this latency was observable to ECMAScript\n      program, it would be a source of indeterminacy that could impact program execution. For that reason, an ECMAScript\n      implementation must not provide any means to observe a key of a WeakMap that does not require the observer to present the\n      observed key.</p>\n\n      <p>WeakMap objects must be implemented using either hash tables or other mechanisms that, on average, provide access times\n      that are sublinear on the number of key/value pairs in the collection. The data structure used in this WeakMap objects\n      specification are only intended to describe the required observable semantics of WeakMap objects. It is not intended to be a\n      viable implementation model.</p>\n\n      <div class=\"note\">\n        <p><span class=\"nh\">NOTE</span> WeakMap and WeakSets are intended to provide mechanisms for dynamically associating state\n        with an object in a manner that does not &#x201C;leak&#x201D; memory resources if, in the absence of the WeakMap or WeakSet,\n        the object otherwise became inaccessible and subject to resource reclamation by the implementation&#x2019;s garbage\n        collection mechanisms. Achieving this characteristic can be achieved by using an inverted per-object mapping of weak map\n        instances to keys.  Alternatively each weak map may internally store its key to value mappings but this approach requires\n        coordination between the WeakMap or WeakSet implementation and the garbage collector. The following references describe\n        mechanism that may be useful to implementations of WeakMap and WeakSets:</p>\n\n        <p>Barry Hayes. 1997. Ephemerons: a new finalization mechanism. In <i>Proceedings of the 12th ACM SIGPLAN conference on\n        Object-oriented programming, systems, languages, and applications (OOPSLA &apos;97)</i>, A. Michael Berman (Ed.). ACM, New\n        York, NY, USA, 176-183, <a href=\"http://doi.acm.org/10.1145/263698.263733\">http://doi.acm.org/10.1145/263698.263733</a>.</p>\n\n        <p>Alexandra Barros, Roberto Ierusalimschy, Eliminating Cycles in Weak Tables. Journal of Universal Computer Science -\n        J.UCS , vol. 14, no. 21, pp. 3481-3497, 2008, <a href=\"http://www.jucs.org/jucs_14_21/eliminating_cycles_in_weak\">http://www.jucs.org/jucs_14_21/eliminating_cycles_in_weak</a></p>\n      </div>\n    </div>\n\n    <section id=\"sec-weakmap-constructor\">\n      <div class=\"front\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.1\"><a href=\"/sec/sec-weakmap-constructor.html\" title=\"link to this section\">23.3.1</a></span>\n            The WeakMap Constructor</h1>\n\n        <p>The WeakMap constructor is the %WeakMap% intrinsic object and the initial value of the <code>WeakMap</code> property of\n        the global object. When called as a constructor it creates and initializes a new WeakMap object. <code>WeakMap</code> is\n        not intended to be called as a function and will throw an exception when called in that manner.</p>\n\n        <p>The <code>WeakMap</code> constructor is designed to be subclassable. It may be used as the value in an\n        <code>extends</code> clause of a class definition. Subclass constructors that intend to inherit the specified\n        <code>WeakMap</code> behaviour must include a <code>super</code> call to the <code>WeakMap</code> constructor to create\n        and initialize the subclass instance with the internal state necessary to support the <code><a href=\"/sec/sec-weakmap.prototype.html\">WeakMap.prototype</a></code> built-in methods.</p>\n      </div>\n\n      <section id=\"sec-weakmap-iterable\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.1.1\"><a href=\"/sec/sec-weakmap-iterable.html\" title=\"link to this section\">23.3.1.1</a></span> WeakMap ( [ iterable ] )</h1>\n\n        <p class=\"normalbefore\">When the <code>WeakMap</code> function is called with optional argument <var>iterable</var> the\n        following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>If NewTarget is <b>undefined</b>, throw a <b>TypeError</b> exception.</li>\n          <li>Let <i>map</i> be <a href=\"/sec/sec-ordinarycreatefromconstructor.html\">OrdinaryCreateFromConstructor</a>(NewTarget,\n              <code>&quot;%WeakMapPrototype%&quot;</code>, &#xAB;&#x200D;[[WeakMapData]]&#xBB; ).</li>\n          <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>map</i>).</li>\n          <li>Set <i>map&#x2019;s</i> [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>\n              to a new empty <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a>.</li>\n          <li>If <i>iterable</i> is not present, let <i>iterable</i> be <b>undefined</b>.</li>\n          <li>If <i>iterable</i> is either <b>undefined</b> or <b>null</b>, let <i>iter</i> be <b>undefined</b>.</li>\n          <li>Else,\n            <ol class=\"block\">\n              <li>Let <i>adder</i> be <a href=\"/sec/sec-get-o-p.html\">Get</a>(<i>map</i>, <code>&quot;set&quot;</code>)<b>.</b></li>\n              <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>adder</i>).</li>\n              <li>If <a href=\"/sec/sec-iscallable.html\">IsCallable</a>(<i>adder</i>) is <b>false</b>, throw a <b>TypeError</b>\n                  exception.</li>\n              <li>Let <i>iter</i> be <a href=\"/sec/sec-getiterator.html\">GetIterator</a>(<i>iterable</i>).</li>\n              <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>iter</i>).</li>\n            </ol>\n          </li>\n          <li>If <i>iter</i> is <b>undefined</b>, return <i>map</i>.</li>\n          <li>Repeat\n            <ol class=\"block\">\n              <li>Let <i>next</i> be <a href=\"/sec/sec-iteratorstep.html\">IteratorStep</a>(<i>iter</i>).</li>\n              <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>next</i>).</li>\n              <li>If <i>next</i> is <b>false</b>, return <i>map</i>.</li>\n              <li>Let <i>nextItem</i> be <a href=\"/sec/sec-iteratorvalue.html\">IteratorValue</a>(<i>next</i>).</li>\n              <li><a href=\"/sec/sec-returnifabrupt.html\">ReturnIfAbrupt</a>(<i>nextItem</i>).</li>\n              <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>nextItem</i>) is not Object,\n                <ol class=\"block\">\n                  <li>Let <i>error</i> be <a href=\"/sec/sec-completion-record-specification-type.html\">Completion</a>{[[type]]: <span style=\"font-family: sans-serif\">throw</span>, [[value]]: a newly created <b>TypeError</b> object,\n                      [[target]]:<span style=\"font-family: sans-serif\">empty</span>}.</li>\n                  <li>Return <a href=\"/sec/sec-iteratorclose.html\">IteratorClose</a>(<i>iter</i>, <i>error</i>).</li>\n                </ol>\n              </li>\n              <li>Let <i>k</i> be <a href=\"/sec/sec-get-o-p.html\">Get</a>(<i>nextItem</i>, <code>&quot;0&quot;</code>).</li>\n              <li>If <i>k</i> is an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>, return <a href=\"/sec/sec-iteratorclose.html\">IteratorClose</a>(<i>iter</i>, <i>k</i>).</li>\n              <li>Let <i>v</i> be <a href=\"/sec/sec-get-o-p.html\">Get</a>(<i>nextItem</i>, <code>&quot;1&quot;</code>).</li>\n              <li>If <i>v</i> is an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>, return <a href=\"/sec/sec-iteratorclose.html\">IteratorClose</a>(<i>iter</i>, <i>v</i>).</li>\n              <li>Let <i>status</i> be <a href=\"/sec/sec-call.html\">Call</a>(<i>adder</i>, <i>map</i>, &#xAB;<i>k</i>.[[value]],\n                  <i>v</i>.[[value]]&#xBB;).</li>\n              <li>If <i>status</i> is an <a href=\"/sec/sec-completion-record-specification-type.html\">abrupt completion</a>, return <a href=\"/sec/sec-iteratorclose.html\">IteratorClose</a>(<i>iter</i>, <i>status</i>).</li>\n            </ol>\n          </li>\n        </ol>\n\n        <div class=\"note\">\n          <p><span class=\"nh\">NOTE</span> If the parameter <var>iterable</var> is present, it is expected to be an object that\n          implements an <span style=\"font-family: Times New Roman\">@@iterator</span> method that returns an iterator object that\n          produces a two element array-like object whose first element is a value that will be used as a WeakMap key and whose\n          second element is the value to associate with that key.</p>\n        </div>\n      </section>\n    </section>\n\n    <section id=\"sec-properties-of-the-weakmap-constructor\">\n      <div class=\"front\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.2\"><a href=\"/sec/sec-properties-of-the-weakmap-constructor.html\" title=\"link to this section\">23.3.2</a></span> Properties of the WeakMap Constructor</h1>\n\n        <p>The value of the [[Prototype]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a> of the\n        WeakMap constructor is the intrinsic object %FunctionPrototype% (<a href=\"/sec/sec-properties-of-the-function-prototype-object.html\">19.2.3</a>).</p>\n\n        <p>Besides the <code>length</code> property (whose value is <b>0</b>), the WeakMap constructor has the following\n        properties:</p>\n      </div>\n\n      <section id=\"sec-weakmap.prototype\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.2.1\"><a href=\"/sec/sec-weakmap.prototype.html\" title=\"link to this section\">23.3.2.1</a></span> WeakMap.prototype</h1>\n\n        <p>The initial value of <code>WeakMap.prototype</code> is the intrinsic object %WeakMapPrototype% (<a href=\"/sec/sec-properties-of-the-weakmap-prototype-object.html\">23.3.3</a>).</p>\n\n        <p>This property has the attributes { [[Writable]]: <b>false</b>, [[Enumerable]]: <b>false</b>, [[Configurable]]:\n        <b>false</b> }.</p>\n      </section>\n    </section>\n\n    <section id=\"sec-properties-of-the-weakmap-prototype-object\">\n      <div class=\"front\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3\"><a href=\"/sec/sec-properties-of-the-weakmap-prototype-object.html\" title=\"link to this section\">23.3.3</a></span> Properties of the WeakMap Prototype Object</h1>\n\n        <p>The WeakMap prototype object is the intrinsic object %WeakMapPrototype%. The value of the [[Prototype]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a> of the WeakMap prototype object is the intrinsic\n        object %ObjectPrototype% (<a href=\"/sec/sec-properties-of-the-object-prototype-object.html\">19.1.3</a>). The WeakMap prototype\n        object is an ordinary object. It does not have a [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</p>\n      </div>\n\n      <section id=\"sec-weakmap.prototype.constructor\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.1\"><a href=\"/sec/sec-weakmap.prototype.constructor.html\" title=\"link to this section\">23.3.3.1</a></span> WeakMap.prototype.constructor</h1>\n\n        <p>The initial value of <code>WeakMap.prototype.constructor</code> is the intrinsic object %WeakMap%.</p>\n      </section>\n\n      <section id=\"sec-weakmap.prototype.delete\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.2\"><a href=\"/sec/sec-weakmap.prototype.delete.html\" title=\"link to this section\">23.3.3.2</a></span> WeakMap.prototype.delete ( key )</h1>\n\n        <p class=\"normalbefore\">The following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>M</i> be the <b>this</b> value.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>M</i>) is not Object, throw a <b>TypeError</b>\n              exception.</li>\n          <li>If <i>M</i> does not have a [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal\n              slot</a>, throw a <b>TypeError</b> exception.</li>\n          <li>Let <i>entries</i> be the <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> that is the value of\n              <i>M</i>&#x2019;s [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>key</i>) is not Object, return <b>false</b>.</li>\n          <li>Repeat for each Record {[[key]], [[value]]} <i>p</i> that is an element of <i>entries,</i>\n            <ol class=\"block\">\n              <li>If <i>p</i>.[[key]] is not <span style=\"font-family: sans-serif\">empty</span> and <a href=\"/sec/sec-samevalue.html\">SameValue</a>(<i>p</i>.[[key]], <i>key</i>) is <b>true</b>, then\n                <ol class=\"block\">\n                  <li>Set <i>p</i>.[[key]] to <span style=\"font-family: sans-serif\">empty</span><i>.</i></li>\n                  <li>Set <i>p</i>.[[value]] to <span style=\"font-family: sans-serif\">empty</span><i>.</i></li>\n                  <li>Return <b>true</b>.</li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>Return <b>false</b>.</li>\n        </ol>\n\n        <div class=\"note\">\n          <p><span class=\"nh\">NOTE</span> The value <b>empty</b> is used as a specification device to indicate that an entry has\n          been deleted. Actual implementations may take other actions such as physically removing the entry from internal data\n          structures.</p>\n        </div>\n      </section>\n\n      <section id=\"sec-weakmap.prototype.get\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.3\"><a href=\"/sec/sec-weakmap.prototype.get.html\" title=\"link to this section\">23.3.3.3</a></span> WeakMap.prototype.get ( key )</h1>\n\n        <p class=\"normalbefore\">The following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>M</i> be the <b>this</b> value.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>M</i>) is not Object, throw a <b>TypeError</b>\n              exception.</li>\n          <li>If <i>M</i> does not have a [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal\n              slot</a>, throw a <b>TypeError</b> exception.</li>\n          <li>Let <i>entries</i> be the <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> that is the value of\n              <i>M</i>&#x2019;s [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>key</i>) is not Object, return\n              <b>undefined</b>.</li>\n          <li>Repeat for each Record {[[key]], [[value]]} <i>p</i> that is an element of <i>entries,</i>\n            <ol class=\"block\">\n              <li>If <i>p</i>.[[key]] is not <span style=\"font-family: sans-serif\">empty</span> and <a href=\"/sec/sec-samevalue.html\">SameValue</a>(<i>p</i>.[[key]], <i>key</i>) is <b>true</b>, return\n                  <i>p</i>.[[value]].</li>\n            </ol>\n          </li>\n          <li>Return  <b>undefined</b><i>.</i></li>\n        </ol>\n      </section>\n\n      <section id=\"sec-weakmap.prototype.has\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.4\"><a href=\"/sec/sec-weakmap.prototype.has.html\" title=\"link to this section\">23.3.3.4</a></span> WeakMap.prototype.has ( key )</h1>\n\n        <p class=\"normalbefore\">The following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>M</i> be the <b>this</b> value.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>M</i>) is not Object, throw a <b>TypeError</b>\n              exception.</li>\n          <li>If <i>M</i> does not have a [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal\n              slot</a>, throw a <b>TypeError</b> exception.</li>\n          <li>Let <i>entries</i> be the <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> that is the value of\n              <i>M</i>&#x2019;s [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>key</i>) is not Object, return <b>false</b>.</li>\n          <li>Repeat for each Record {[[key]], [[value]]} <i>p</i> that is an element of <i>entries,</i>\n            <ol class=\"block\">\n              <li>If <i>p</i>.[[key]] is not <span style=\"font-family: sans-serif\">empty</span> and <a href=\"/sec/sec-samevalue.html\">SameValue</a>(<i>p</i>.[[key]], <i>key</i>) is <b>true</b>, return\n                  <b>true</b><i>.</i></li>\n            </ol>\n          </li>\n          <li>Return <b>false</b>.</li>\n        </ol>\n      </section>\n\n      <section id=\"sec-weakmap.prototype.set\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.5\"><a href=\"/sec/sec-weakmap.prototype.set.html\" title=\"link to this section\">23.3.3.5</a></span> WeakMap.prototype.set ( key , value )</h1>\n\n        <p class=\"normalbefore\">The following steps are taken:</p>\n\n        <ol class=\"proc\">\n          <li>Let <i>M</i> be the <b>this</b> value.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>M</i>) is not Object, throw a <b>TypeError</b>\n              exception.</li>\n          <li>If <i>M</i> does not have a [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal\n              slot</a>, throw a <b>TypeError</b> exception.</li>\n          <li>Let <i>entries</i> be the <a href=\"/sec/sec-list-and-record-specification-type.html\">List</a> that is the value of\n              <i>M</i>&#x2019;s [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</li>\n          <li>If <a href=\"/sec/sec-ecmascript-data-types-and-values.html\">Type</a>(<i>key</i>) is not Object, throw a <b>TypeError</b>\n              exception.</li>\n          <li>Repeat for each Record {[[key]], [[value]]} <i>p</i> that is an element of <i>entries,</i>\n            <ol class=\"block\">\n              <li>If <i>p</i>.[[key]] is not <span style=\"font-family: sans-serif\">empty</span> and <a href=\"/sec/sec-samevalue.html\">SameValue</a>(<i>p</i>.[[key]], <i>key</i>) is <b>true</b>, then\n                <ol class=\"block\">\n                  <li>Set <i>p</i>.[[value]] to <i>value.</i></li>\n                  <li>Return <i>M</i>.</li>\n                </ol>\n              </li>\n            </ol>\n          </li>\n          <li>Let <i>p</i> be the Record {[[key]]: <i>key</i>, [[value]]: <i>value</i>}.</li>\n          <li>Append <i>p</i> as the last element of <i>entries</i>.</li>\n          <li>Return <i>M</i>.</li>\n        </ol>\n      </section>\n\n      <section id=\"sec-weakmap.prototype-@@tostringtag\">\n        <h1><span class=\"secnum\" id=\"sec-23.3.3.6\"><a href=\"/sec/sec-weakmap.prototype-@@tostringtag.html\" title=\"link to this section\">23.3.3.6</a></span> WeakMap.prototype [ @@toStringTag ]</h1>\n\n        <p>The initial value of the @@toStringTag property is the String value <code>&quot;WeakMap&quot;</code>.</p>\n\n        <p>This property has the attributes { [[Writable]]: <span class=\"value\">false</span>, [[Enumerable]]: <span class=\"value\">false</span>, [[Configurable]]: <span class=\"value\">true</span> }.</p>\n      </section>\n    </section>\n\n    <section id=\"sec-properties-of-weakmap-instances\">\n      <h1><span class=\"secnum\" id=\"sec-23.3.4\"><a href=\"/sec/sec-properties-of-weakmap-instances.html\" title=\"link to this section\">23.3.4</a></span> Properties of WeakMap Instances</h1>\n\n      <p>WeakMap instances are ordinary objects that inherit properties from the WeakMap prototype. WeakMap instances also have a\n      [[WeakMapData]] <a href=\"/sec/sec-object-internal-methods-and-internal-slots.html\">internal slot</a>.</p>\n    </section>\n  "}